#!/bin/bash
BUILD=$(readlink -f .)
SRC=$(readlink -f $(dirname $0))
TARGET=$(uname)
if [ "$SRC" == "$BUILD" ]; then
    echo "Refusing to set up build in source directory."
    echo "try: mkdir -p build; cd build; ../configure"
    exit 1
fi

echo "SRC=$SRC"
echo "BUILD=$BUILD"

cat <<EOF >Makefile
# Generated by $SRC/configure
SRC:=$SRC
BUILD:=$BUILD
TARGET:=$TARGET
.PHONY: all
all:
	+make -f \$(SRC)/main.mk TARGET="\$(TARGET)" SRC="\$(SRC)" BUILD="\$(BUILD)"
EOF

echo "Now run 'make'"

