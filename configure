#!/bin/bash

# custom configure & build system.
# all files reside in the build/ dir

# set some env variables and call configure.pl
BUILDDIR=`pwd`    # not yet used: call it locally!
cd `dirname $0`
SRCDIR=`pwd`


if [ $SRCDIR == $BUILDDIR ]; then
    BUILDDIR=$SRCDIR/build
    echo "Can't build in source dir $SRDCIR."
    echo "Will build in $BUILDDIR instead."
    mkdir -p $BUILDDIR
fi



LOG=$BUILDDIR/build.log

echo "source:  $SRCDIR"
echo "build:   $BUILDDIR"

export SRCDIR
export BUILDDIR

# gather some data
echo >>$LOG
echo -n "libpf configure -- " >>$LOG
date >>$LOG
echo >>$LOG

uname -a >>$LOG
echo >>$LOG



# copy build tree
# cd $BUILDDIR
# cp $SRCDIR/Makefile .
# cp $SRCDIR/Makefile.rules .
# if [ $SRCDIR != $BUILDDIR ]; then
#     for dir in test leaf ex sc pf jni; do
#         mkdir -p $dir
#         cp $SRCDIR/$dir/Makefile $dir
#     done
# fi


# Build starting point is a single Makefile.
rm -f $BUILDDIR/Makefile
ln -s $SRCDIR/project.mk $BUILDDIR/Makefile

# execute main configure script
exec perl $SRCDIR/bin/configure.pl $* 2>>$LOG


